#!/usr/bin/env node

var eco = require('eco');
var fs = require('fs');

fs.readdir(__dirname + '/../src/views', function(err, files) {
  if (err) {
    console.log(err);
    throw err;
  }
  
  files.forEach(function(file) {
    fs.readFile(__dirname + '/../src/views/' + file, function(err, data) {
      if (err) {
        console.log(err);
        throw err;
      }
      
      var template = eco.precompile(data.toString());

      filename = file.substr(file.lastIndexOf('/') + 1);
      filename = filename.replace(/\.(.+)/, '.js');

      templateFile = "module.exports = " + template.toString();

      filepath = __dirname + '/../lib/views/' + filename;

      fs.writeFile(filepath, templateFile, function(err) {
        if (err) {
          console.log(err);
          throw err;
        }
      });
    });
  });
});